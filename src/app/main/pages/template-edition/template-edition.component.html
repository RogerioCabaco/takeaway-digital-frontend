<div class="page-layout carded left-sidebar tabbed inner-scroll">

    <!-- TOP BACKGROUND -->
    <div class="top-bg accent"></div>
    <!-- / TOP BACKGROUND -->

    <!-- SIDEBAR -->
    <fuse-sidebar class="sidebar" name="carded-left-sidebar-tabbed-2" position="left" lockedOpen="gt-md">

        <!-- SIDEBAR HEADER -->
        <div class="header p-24 accent">
            <h2 class="m-0 d-flex">
                <mat-icon role="img"
                    class="mat-icon notranslate logo-icon s-32 mr-16 ng-tns-c395-43 ng-trigger ng-trigger-animate material-icons mat-icon-no-color"
                    aria-hidden="true" data-mat-icon-type="font">aspect_ratio</mat-icon>
                Conteúdo
            </h2>
        </div>
        <!-- / SIDEBAR HEADER -->

        <!-- SIDEBAR CONTENT -->
        <div class="content p-24" fusePerfectScrollbar>
            <template-edition-pages-sidebar [activePage]="activePage" [pages]="templateForm.controls['pages']">
            </template-edition-pages-sidebar>
        </div>
        <!-- / SIDEBAR CONTENT -->

    </fuse-sidebar>
    <!-- / SIDEBAR -->

    <!-- CENTER -->
    <div class="center">

        <!-- CONTENT HEADER -->
        <div class="header accent p-24">

            <h2 class="m-0 template-title">Template - {{templateService.activeTemplate.name}}</h2>
            <div class="btn-actions">
                <button mat-raised-button color="primary" aria-label="Send Message"
                    (click)="publishTemplate()">Publicar</button>
                <button mat-raised-button aria-label="Send Message" (click)="savingTemplate()">Salvar</button>
            </div>

        </div>
        <!-- / CONTENT HEADER -->

        <!-- CONTENT CARD -->
        <div class="content-card">

            <!-- CONTENT -->
            <div class="content" id="content">
                <nav mat-tab-nav-bar>
                    <a mat-tab-link *ngFor="let section of getSections" (click)="changeSections(section)"
                        [active]="activeSection == section"> {{section.value.name}}
                    </a>
                </nav>
                <div class="tab-content p-24" fusePerfectScrollbar>

                    <form class="mat-card mat-elevation-z4 p-24 mr-24 width-100" name="form"
                        [formGroup]="activeSection">
                        <section>
                            <div class="actions mb-24 d-flex-between" [@animate]="{value:'*',params:{delay:'200ms'}}">
                                <h2>{{activeSection.value.name}}</h2>
                                <button mat-raised-button color="primary" aria-label="Send Message"
                                    (click)="showPreview()">Preview</button>
                            </div>

                            <div>

                                <mat-form-field *ngIf="activeSection.value.hasTitle" appearance="outline" fxFlex="50"
                                    class="pr-4">
                                    <mat-label>Título</mat-label>
                                    <input matInput formControlName="title" required>
                                    <mat-icon matSuffix class="secondary-text">account_circle</mat-icon>
                                    <mat-error>Título é obrigatório!</mat-error>
                                </mat-form-field>

                                <mat-form-field *ngIf="activeSection.value.hasSubTitle" appearance="outline" fxFlex="50"
                                    class="pl-4">
                                    <mat-label>Sub-título</mat-label>
                                    <input matInput formControlName="sub_title" required>
                                    <mat-icon matSuffix class="secondary-text">account_circle</mat-icon>
                                    <mat-error>Campo obrigatório !</mat-error>
                                </mat-form-field>

                            </div>

                            <section formArrayName="info_groups">
                                <div *ngFor="let infoGroup of activeInfoGroups; let j = index" [formGroupName]="j">
                                    <div class="actions mb-24 d-flex-between"
                                        [@animate]="{value:'*',params:{delay:'200ms'}}">
                                        <h2>Grupo {{j+1}}</h2>
                                    </div>
                                    <!-- Fotos -->
                                    <ng-container *ngIf="infoGroup.value.photos.length > 0">
                                        <div fxLayout="row">
                                            <h2 class="info-group-title">Fotos</h2>
                                        </div>
                                        <div class="p-grid" formArrayName="photos">
                                            <div *ngFor="let photo of infoPhotos(infoGroup); let photoIndex = index"
                                                class="boxed photo-content p-col-4">
                                                <div class="photo-img">
                                                    <img
                                                        [src]="photo.value.value ? photo.value.value : 'assets/images/avatars/profile.jpg'">
                                                </div>

                                                <div class="photo-btns">
                                                    <button mat-raised-button color="primary" aria-label="Send Message"
                                                        (click)="uploadPhoto(photo)">Upload</button>

                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <!-- Vídeos -->
                                    <ng-container *ngIf="infoGroup.value.videos.length > 0">
                                        <div fxLayout="row">
                                            <h2 class="info-group-title">Vídeos</h2>
                                        </div>
                                        <div fxLayout="row">
                                            <div class="boxed">
                                                Vídeos
                                            </div>
                                        </div>
                                    </ng-container>
                                    <!-- Ficheiros -->
                                    <ng-container *ngIf="infoGroup.value.files.length > 0">
                                        <div fxLayout="row">
                                            <h2 class="info-group-title">Ficheiros</h2>
                                        </div>
                                        <div fxLayout="row">
                                            <div class="boxed">
                                                Ficheiros
                                            </div>
                                        </div>
                                    </ng-container>
                                    <!-- Textos -->
                                    <ng-container *ngIf="infoGroup.value.texts.length > 0">
                                        <div>
                                            <h2 class="info-group-title">Textos</h2>
                                        </div>
                                        <div>
                                            <div class="p-grid" formArrayName="texts">
                                                <div *ngFor="let textItem of getTexts(infoGroup); index as k"
                                                    [formGroupName]="k" class="boxed p-col-6">
                                                    <mat-form-field appearance="outline">
                                                        <mat-label>Texto {{k+1}}</mat-label>
                                                        <input matInput formControlName="value">
                                                        <mat-icon matSuffix class="secondary-text">account_circle
                                                        </mat-icon>
                                                    </mat-form-field>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                            </section>
                        </section>
                    </form>
                </div>

            </div>
            <!-- / CONTENT -->

        </div>
        <!-- / CONTENT CARD -->

    </div>
    <!-- / CENTER -->

</div>

<window *ngIf="showPortal" [externalUrl]="externalUrl">
    <h2>Hello world from amother window!!</h2>
    <button (click)="this.showPortal = false">Close me!</button>
</window>